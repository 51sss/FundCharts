/**
 * pie chart
 * drawer
 */

import Config from'../config'import{Animation}from'../utils/animate'const pieColors=Config.pie.colors;export default class Pie{constructor(FundChart){if(!FundChart)throw new Error('Error!no canvas element.(FundChart-draw)');this.chartjs=FundChart;}clearCtn(lineCtnBool){let ctx=this.chartjs.ctx;ctx.beginPath();if(lineCtnBool)ctx.rect(46,0,this.chartjs._chart.width,this.chartjs._chart.height-22);else ctx.rect(0,0,this.chartjs._chart.width,this.chartjs._chart.height);ctx.fillStyle=Config.background;ctx.fill();ctx.closePath();}drawPie(data_arr,color_arr,annularRate=0.6,process=1){color_arr=color_arr.concat(pieColors);this.clearCtn();let ctx=this.chartjs.ctx;annularRate=annularRate>0.9&&0.9||annularRate;let radius=this.chartjs._chart.height/2-20,radiusWhite=radius*annularRate,_origin=this.chartjs.opts.origin||{x:this.chartjs._chart.width/2,y:radius+20},ox=_origin.x,oy=_origin.y;let startAngle=-0.5*Math.PI,endAngle=-0.5*Math.PI;for(let i in data_arr){endAngle+=data_arr[i]*2*Math.PI*process;ctx.fillStyle=color_arr[i]&&~color_arr[i].indexOf('#')?color_arr[i]:pieColors[i];ctx.beginPath();ctx.moveTo(ox,oy);ctx.arc(ox,oy,radius,startAngle,endAngle,false);ctx.closePath();ctx.fill();startAngle=endAngle;}ctx.fillStyle='#fff';ctx.beginPath();ctx.moveTo(ox,oy);if(radiusWhite)ctx.arc(ox,oy,radiusWhite,0,Math.PI*2,false);ctx.closePath();ctx.fill();}init(){let _opts=this.chartjs.opts;if(_opts.noanimatebool||!Config.inBrowser){this.drawPie(_opts.datas,_opts.colors,_opts.annularRate,1);}else{Animation({timing:'easeInOut',duration:600,onProcess:process=>{this.drawPie(_opts.datas,_opts.colors,_opts.annularRate,process);},onAnimationFinish:()=>{console.log('pie chart finish');}});}}}